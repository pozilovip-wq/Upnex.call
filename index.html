<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upnex Call Center</title>

  <style>
    :root {
      --bg: #f2f4f7;
      --card-bg: #ffffff;
      --accent: #2563eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border: #e5e7eb;
      --danger: #ef4444;
      --radius: 16px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #e6f4ff, #edf2f7);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 24px;
      color: var(--text-main);
    }

    .app {
      width: 100%;
      max-width: 1100px;
      background: #ffffffee;
      border-radius: 28px;
      padding: 24px;
      box-shadow: 0 20px 50px rgba(0,0,0,.15);
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      gap: 12px;
    }

    h1 { margin: 0; font-size: 22px; }

    .subtitle {
      font-size: 13px;
      color: var(--text-muted);
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 13px;
      cursor: pointer;
      background: #e5e7eb;
    }

    .btn-primary { background: var(--accent); color: #fff; }
    .btn-danger { background: var(--danger); color: #fff; }

    main {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    @media (max-width: 900px) {
      main { grid-template-columns: 1fr; }
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 16px;
      border: 1px solid var(--border);
    }

    label {
      font-size: 12px;
      color: var(--text-muted);
      display: block;
      margin-bottom: 4px;
    }

    input, select, textarea {
      width: 100%;
      padding: 8px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font-size: 13px;
    }

    textarea { resize: vertical; min-height: 70px; }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .full { grid-column: 1 / -1; }

    .leads {
      max-height: 520px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .lead {
      padding: 10px;
      border-radius: 12px;
      background: #f9fafb;
      border: 1px solid var(--border);
      font-size: 13px;
    }

    .lead strong { font-size: 14px; }

    .toast {
      position: fixed;
      bottom: 16px;
      right: 16px;
      background: #111827;
      color: #fff;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 12px;
      opacity: 0;
      transition: .2s;
    }

    .toast.show { opacity: 1; }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <div>
        <h1>Upnex Call Center</h1>
        <div class="subtitle">Netlify Forms + LocalStorage</div>
      </div>
      <div>
        <button id="export" class="btn-primary">CSV yuklab olish</button>
        <button id="clear" class="btn-danger">Tozalash</button>
      </div>
    </header>

    <main>
      <!-- FORM -->
      <section class="card">
        <h3>Yangi qo‘ng‘iroq</h3>

        <form
          name="upnex-calls"
          method="POST"
          data-netlify="true"
          netlify
        >
          <!-- REQUIRED FOR NETLIFY -->
          <input type="hidden" name="form-name" value="upnex-calls" />
          <input type="hidden" name="bot-field" />

          <div class="grid">
            <div>
              <label>Ism</label>
              <input name="fullName" required />
            </div>

            <div>
              <label>Telefon</label>
              <input name="phone" required />
            </div>

            <div>
              <label>Sabab</label>
              <select name="reason">
                <option>USA – Bakalavr</option>
                <option>USA – Magistr</option>
                <option>Yevropa / Osiyo</option>
                <option>IELTS</option>
              </select>
            </div>

            <div>
              <label>Manba</label>
              <select name="source">
                <option>Instagram</option>
                <option>Telegram</option>
                <option>WhatsApp</option>
              </select>
            </div>

            <div class="full">
              <label>Izoh</label>
              <textarea name="notes"></textarea>
            </div>

            <div>
              <label>Operator</label>
              <input name="operator" />
            </div>

            <div>
              <label>Status</label>
              <select name="status">
                <option value="new">Yangi</option>
                <option value="called">Qo‘ng‘iroq qilindi</option>
                <option value="noanswer">Ko‘tar-madi</option>
                <option value="bad">Mos emas</option>
              </select>
            </div>
          </div>

          <br />
          <button type="submit" class="btn-primary">Saqlash</button>
        </form>
      </section>

      <!-- LEADS -->
      <section class="card">
        <h3>So‘nggi leadlar</h3>
        <div id="leads" class="leads"></div>
      </section>
    </main>
  </div>

  <div id="toast" class="toast">Lead saqlandi ✅</div>

  <script>
    const STORAGE = "upnex_leads_v3";
    const leadsEl = document.getElementById("leads");
    const toast = document.getElementById("toast");
    const exportBtn = document.getElementById("export");
    const clearBtn = document.getElementById("clear");

    let leads = JSON.parse(localStorage.getItem(STORAGE) || "[]");

    function render() {
      leadsEl.innerHTML = "";
      if (!leads.length) {
        leadsEl.innerHTML = "<div>Hozircha lead yo‘q</div>";
        return;
      }
      leads.slice().reverse().forEach(l => {
        leadsEl.innerHTML += `
          <div class="lead">
            <strong>${l.fullName}</strong> (${l.phone})<br/>
            ${l.reason} • ${l.source}<br/>
            <small>${l.operator || "-"} | ${l.status}</small>
          </div>
        `;
      });
    }

    render();

    document.querySelector("form").addEventListener("submit", e => {
      const data = new FormData(e.target);
      const lead = Object.fromEntries(data.entries());
      lead.createdAt = Date.now();
      leads.push(lead);
      localStorage.setItem(STORAGE, JSON.stringify(leads));
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 1500);
    });

    exportBtn.onclick = () => {
      if (!leads.length) return alert("Lead yo‘q");
      const keys = Object.keys(leads[0]);
      const csv = [
        keys.join(","),
        ...leads.map(l => keys.map(k => `"${l[k]||""}"`).join(","))
      ].join("\n");

      const a = document.createElement("a");
      a.href = URL.createObjectURL(new Blob([csv]));
      a.download = "upnex-leads.csv";
      a.click();
    };

    clearBtn.onclick = () => {
      if (confirm("Barchasini o‘chiraymi?")) {
        leads = [];
        localStorage.removeItem(STORAGE);
        render();
      }
    };
  </script>
</body>
</html>
